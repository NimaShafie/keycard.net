<!-- Modules/Folio/Views/FolioView.axaml -->
<UserControl
    x:Class="KeyCard.Desktop.Modules.Folio.Views.FolioView"
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:vm="clr-namespace:KeyCard.Desktop.Modules.Folio.ViewModels"
    mc:Ignorable="d"
    x:DataType="vm:FolioViewModel">

  <!-- Reduced margin from 12 to 8 to match Dashboard -->
  <Grid RowDefinitions="Auto,*,Auto" Margin="8">

    <!-- Header -->
    <Border Grid.Row="0"
            CornerRadius="10"
            BorderBrush="#3F2F73"
            BorderThickness="1"
            Padding="16,12"
            Margin="0,0,0,8"
            Background="#1B1B22">
      <StackPanel>
        <TextBlock Text="Folio Manager"
                   FontWeight="SemiBold"
                   FontSize="18"
                   Foreground="#E8E8F0"/>
        <TextBlock Text="Manage charges, payments, and statements"
                   FontSize="12"
                   Opacity="0.7"
                   Foreground="#CFCFEA"
                   Margin="0,2,0,0"/>
      </StackPanel>
    </Border>

    <!-- Main content -->
    <Border Grid.Row="1"
            CornerRadius="10"
            BorderBrush="#3F2F73"
            BorderThickness="1"
            Padding="12"
            Background="#18181E">
      <Grid ColumnDefinitions="*,340" RowDefinitions="*">

        <!-- Folios table with proper border - matching Dashboard table style -->
        <Border Grid.Row="0" Grid.Column="0"
                Background="#141419"
                BorderBrush="#4B3A86"
                BorderThickness="1"
                CornerRadius="8"
                Padding="6"
                ClipToBounds="True"
                Margin="0,0,8,0">
          <DataGrid
              Name="FolioDataGrid"
              ItemsSource="{Binding Folios}"
              SelectedItem="{Binding SelectedFolio, Mode=TwoWay}"
              AutoGenerateColumns="False"
              CanUserReorderColumns="False"
              CanUserResizeColumns="True"
              CanUserSortColumns="True"
              HeadersVisibility="Column"
              IsReadOnly="True"
              GridLinesVisibility="Horizontal"
              Background="#141419"
              BorderThickness="0"
              RowHeight="36">

            <DataGrid.Columns>
              <DataGridTextColumn Header="Guest"
                                  Binding="{Binding GuestName}"
                                  Width="180"/>
              <DataGridTextColumn Header="Folio #"
                                  Binding="{Binding FolioId}"
                                  Width="140"/>
              <DataGridTextColumn Header="Balance"
                                  Binding="{Binding Balance, StringFormat=\{0:C\}}"
                                  Width="120"/>
              <DataGridTextColumn Header="Status"
                                  Binding="{Binding Status}"
                                  Width="*"/>

              <!-- Actions -->
              <DataGridTemplateColumn Header="Actions" Width="120">
                <DataGridTemplateColumn.CellTemplate>
                  <DataTemplate>
                    <Button Content="Details"
                            Padding="12,6"
                            CornerRadius="6"
                            Background="#5C46A3"
                            Foreground="White"
                            HorizontalAlignment="Center"
                            Click="OnDetailsButtonClick"
                            Tag="{Binding FolioId}" />
                  </DataTemplate>
                </DataGridTemplateColumn.CellTemplate>
              </DataGridTemplateColumn>
            </DataGrid.Columns>
          </DataGrid>
        </Border>

        <!-- Right-side actions -->
        <StackPanel Grid.Column="1" Spacing="12" Margin="8,0,0,0">

          <!-- Add Charge -->
          <Border Classes="panel-subcard"
                  BorderThickness="1"
                  BorderBrush="#5C46A3"
                  CornerRadius="8"
                  Background="#2B2B33"
                  Padding="12">
            <StackPanel Spacing="10">
              <TextBlock Text="Add Charge"
                         FontWeight="SemiBold"
                         FontSize="14"
                         Foreground="#EDECF7"/>

              <TextBox Watermark="Description"
                       Text="{Binding NewChargeDescription, Mode=TwoWay}"
                       Background="#1E1E26"
                       Foreground="White"
                       BorderBrush="#5C46A3"
                       CornerRadius="6"
                       Padding="8,6"
                       FontSize="13"
                       Height="32"/>

              <!-- Amount input -->
              <TextBox Watermark="$ 0.00"
                       Text="{Binding ChargeAmountText, Mode=TwoWay}"
                       Background="#1E1E26"
                       Foreground="White"
                       BorderBrush="#5C46A3"
                       CornerRadius="6"
                       Padding="8,6"
                       FontSize="13"
                       Height="32"/>

              <Button Content="Add Charge"
                      Command="{Binding AddChargeCommand}"
                      IsEnabled="{Binding CanAddCharge}"
                      Background="#5C46A3"
                      Foreground="White"
                      CornerRadius="6"
                      Padding="8,6"
                      Height="32"
                      FontSize="13"
                      HorizontalAlignment="Stretch"
                      HorizontalContentAlignment="Center"/>
            </StackPanel>
          </Border>

          <!-- Add Payment -->
          <Border Classes="panel-subcard"
                  BorderThickness="1"
                  BorderBrush="#5C46A3"
                  CornerRadius="8"
                  Background="#2B2B33"
                  Padding="12">
            <StackPanel Spacing="10">
              <TextBlock Text="Add Payment"
                         FontWeight="SemiBold"
                         FontSize="14"
                         Foreground="#EDECF7"/>

              <!-- Amount input -->
              <TextBox Watermark="$ 0.00"
                       Text="{Binding PaymentAmountText, Mode=TwoWay}"
                       Background="#1E1E26"
                       Foreground="White"
                       BorderBrush="#5C46A3"
                       CornerRadius="6"
                       Padding="8,6"
                       FontSize="13"
                       Height="32"/>

              <ComboBox SelectedItem="{Binding NewPaymentMethod, Mode=TwoWay}"
                        ItemsSource="{Binding PaymentMethods}"
                        PlaceholderText="Select payment method"
                        Background="#1E1E26"
                        Foreground="White"
                        BorderBrush="#5C46A3"
                        CornerRadius="6"
                        Padding="8,6"
                        FontSize="13"
                        Height="32"
                        HorizontalAlignment="Stretch"/>

              <Button Content="Add Payment"
                      Command="{Binding AddPaymentCommand}"
                      IsEnabled="{Binding CanAddPayment}"
                      Background="#5C46A3"
                      Foreground="White"
                      CornerRadius="6"
                      Padding="8,6"
                      Height="32"
                      FontSize="13"
                      HorizontalAlignment="Stretch"
                      HorizontalContentAlignment="Center"/>
            </StackPanel>
          </Border>

          <!-- Invoice -->
          <Border Classes="panel-subcard"
                  BorderThickness="1"
                  BorderBrush="#5C46A3"
                  CornerRadius="8"
                  Background="#2B2B33"
                  Padding="12">
            <StackPanel Spacing="10">
              <TextBlock Text="Invoice"
                         FontWeight="SemiBold"
                         FontSize="14"
                         Foreground="#EDECF7"/>
              <Button Content="Generate &amp; Open PDF"
                      Command="{Binding GenerateInvoiceCommand}"
                      Background="#5C46A3"
                      Foreground="White"
                      CornerRadius="6"
                      Padding="8,6"
                      Height="32"
                      FontSize="13"
                      HorizontalAlignment="Stretch"
                      HorizontalContentAlignment="Center"/>
            </StackPanel>
          </Border>

        </StackPanel>
      </Grid>
    </Border>

    <!-- âœ… Status Message Bar -->
    <Border Grid.Row="2"
            Background="#1B1B22"
            BorderBrush="#3F2F73"
            BorderThickness="1"
            CornerRadius="6"
            Padding="12,8"
            Margin="0,8,0,0">
      <TextBlock Text="{Binding StatusMessage}"
                 FontSize="13"
                 Foreground="#E8E8F0"
                 TextWrapping="Wrap"/>
    </Border>
  </Grid>
</UserControl>
