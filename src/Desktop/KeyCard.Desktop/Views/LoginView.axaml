<!-- Views/LoginView.axaml -->
<UserControl
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:vms="clr-namespace:KeyCard.Desktop.ViewModels"
    xmlns:svc="clr-namespace:KeyCard.Desktop.Services"
    xmlns:chrome="clr-namespace:KeyCard.Desktop.Infrastructure.UI"
    x:Class="KeyCard.Desktop.Views.LoginView"
    x:DataType="vms:LoginViewModel"
    chrome:ViewChrome.TopBarVisible="False">

  <!-- Toggle the top bar here: set to True or False -->
  <UserControl.Resources>
    <x:Boolean x:Key="ShowTopBar">False</x:Boolean>
  </UserControl.Resources>

  <!-- Use DockPanel so we can optionally show a top bar above the page -->
  <DockPanel>

    <!-- Optional Top Bar (enable/disable per-view) -->
    <Border
        DockPanel.Dock="Top"
        Height="44"
        Padding="12,6"
        IsVisible="{DynamicResource ShowTopBar}"
        Background="#1E1E24"
        BorderBrush="#2A2A33"
        BorderThickness="0 0 0 1">
      <Grid ColumnDefinitions="Auto,*,Auto">
        <!-- Left: simple nav placeholder -->
        <StackPanel Orientation="Horizontal" Spacing="6" Margin="0,0,8,0">
          <TextBlock Text="Dashboard" Foreground="#CFCFE6" Opacity="0.86"/>
          <TextBlock Text="·" Margin="4,0" Foreground="#8A8AA8"/>
          <TextBlock Text="Front Desk" Foreground="#CFCFE6" Opacity="0.86"/>
          <TextBlock Text="·" Margin="4,0" Foreground="#8A8AA8"/>
          <TextBlock Text="Housekeeping" Foreground="#CFCFE6" Opacity="0.86"/>
          <TextBlock Text="·" Margin="4,0" Foreground="#8A8AA8"/>
          <TextBlock Text="Folio Manager" Foreground="#CFCFE6" Opacity="0.86"/>
        </StackPanel>

        <!-- Middle: spacer -->
        <Border Grid.Column="1"/>

        <!-- Right: mock mode badge mirrors global flag -->
        <Border Grid.Column="2"
                CornerRadius="6"
                Padding="8,2"
                Background="#2C2C34"
                Margin="8,0,0,0"
                IsVisible="{Binding Source={x:Static svc:AppGlobals.Env}, Path=IsMock}">
          <TextBlock Text="MOCK MODE"
                     FontWeight="SemiBold"
                     Foreground="#B388FF"
                     VerticalAlignment="Center"/>
        </Border>
      </Grid>
    </Border>

    <!-- Main content (unchanged) -->
    <Grid>
      <!-- Animated gradient background -->
      <Border x:Name="AnimatedBackground">
        <Border.Background>
          <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#1a0033" Offset="0"/>
            <GradientStop Color="#330066" Offset="0.5"/>
            <GradientStop Color="#0f0f12" Offset="1"/>
          </LinearGradientBrush>
        </Border.Background>
      </Border>

      <!-- Login card -->
      <Border x:Name="LoginCard"
              Classes="login-card"
              Width="440"
              HorizontalAlignment="Center"
              VerticalAlignment="Center">

        <StackPanel Spacing="20">
          <!-- Logo (optional) -->
          <Image x:Name="BrandLogo"
                 Width="80" Height="90"
                 HorizontalAlignment="Center"
                 IsVisible="False"/>

          <!-- Title -->
          <StackPanel Spacing="8">
            <TextBlock Text="KeyCard.NET"
                       FontSize="28"
                       FontWeight="Bold"
                       HorizontalAlignment="Center"
                       Foreground="White"/>
            <TextBlock Text="Staff Console Login"
                       FontSize="14"
                       HorizontalAlignment="Center"
                       Opacity="0.8"
                       Foreground="White"/>
          </StackPanel>

          <!-- Form -->
          <StackPanel Spacing="14" Margin="0,12,0,0">
            <TextBox Watermark="Username or Email"
                     Text="{Binding Username}"
                     Height="42"
                     Padding="14,0"
                     CornerRadius="8"/>

            <TextBox Watermark="Password"
                     PasswordChar="•"
                     Text="{Binding Password}"
                     Height="42"
                     Padding="14,0"
                     CornerRadius="8"/>

            <!-- Error message -->
            <TextBlock Text="{Binding Error}"
                       Foreground="#FF6B6B"
                       FontSize="12"
                       IsVisible="{Binding Error, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                       TextWrapping="Wrap"/>

            <!-- Buttons -->
            <StackPanel Spacing="10" Margin="0,8,0,0">
              <Button Content="Sign In"
                      Command="{Binding LoginCommand}"
                      IsDefault="True"
                      Height="42"
                      FontWeight="SemiBold"
                      CornerRadius="8"
                      Background="#7B1FA2"
                      BorderBrush="#9C27B0"
                      Foreground="White"
                      HorizontalAlignment="Stretch"
                      HorizontalContentAlignment="Center"/>

              <!-- Gate by BOTH: global Env.IsMock AND VM's IsMockMode -->
              <StackPanel IsVisible="{Binding Source={x:Static svc:AppGlobals.Env}, Path=IsMock}">
                <Button Content="Continue in Mock Mode"
                        Command="{Binding ContinueMockCommand}"
                        IsVisible="{Binding IsMockMode}"
                        Height="38"
                        CornerRadius="8"
                        Background="#2C2C34"
                        BorderBrush="#4B3A86"
                        Foreground="White"
                        HorizontalAlignment="Stretch"
                        HorizontalContentAlignment="Center"
                        Opacity="0.9"/>
              </StackPanel>
            </StackPanel>

            <!-- Loading indicator -->
            <ProgressBar IsIndeterminate="True"
                         IsVisible="{Binding IsBusy}"
                         Height="4"
                         Margin="0,8,0,0"/>
          </StackPanel>

          <!-- Footer -->
          <TextBlock Text="© 2025 KeyCard.NET"
                     FontSize="11"
                     HorizontalAlignment="Center"
                     Opacity="0.5"
                     Foreground="White"
                     Margin="0,16,0,0"/>
        </StackPanel>
      </Border>
    </Grid>
  </DockPanel>
</UserControl>
