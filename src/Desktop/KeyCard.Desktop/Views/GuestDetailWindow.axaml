<!-- Views/GuestDetailWindow.axaml -->
<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vms="clr-namespace:KeyCard.Desktop.Modules.Folio.ViewModels"
        x:Class="KeyCard.Desktop.Modules.Folio.Views.GuestDetailWindow"
        x:DataType="vms:GuestDetailViewModel"
        Title="Guest Folio Details"
        Width="900"
        Height="700"
        MinWidth="800"
        MinHeight="600"
        WindowStartupLocation="CenterOwner"
        Background="#1E1E2E"
        CanResize="True">

  <Grid RowDefinitions="Auto,*,Auto" Margin="16">

    <!-- Header -->
    <Border Grid.Row="0"
            CornerRadius="10"
            BorderBrush="#3F2F73"
            BorderThickness="1"
            Padding="16,12"
            Margin="0,0,0,12"
            Background="#1B1B22">
      <Grid ColumnDefinitions="*,Auto">
        <StackPanel>
          <TextBlock Text="{Binding GuestName}"
                     FontWeight="SemiBold"
                     FontSize="20"
                     Foreground="#E8E8F0"/>
          <StackPanel Orientation="Horizontal" Spacing="16" Margin="0,4,0,0">
            <TextBlock FontSize="13" Opacity="0.8">
              <Run Text="Folio #:"/>
              <Run Text="{Binding FolioNumber}" FontWeight="SemiBold"/>
            </TextBlock>
            <TextBlock FontSize="13" Opacity="0.8">
              <Run Text="Status:"/>
              <Run Text="{Binding Status}" FontWeight="SemiBold"/>
            </TextBlock>
            <TextBlock FontSize="13" Opacity="0.8">
              <Run Text="Balance:"/>
              <Run Text="{Binding CurrentBalance, StringFormat='${0:F2}'}" FontWeight="SemiBold" Foreground="#FFB74D"/>
            </TextBlock>
          </StackPanel>
        </StackPanel>

        <TextBlock Grid.Column="1"
                   Text="{Binding ModeNotice}"
                   VerticalAlignment="Center"
                   FontSize="11"
                   Foreground="#9C27B0"
                   Opacity="0.8"/>
      </Grid>
    </Border>

    <!-- Tabbed Content -->
    <TabControl Grid.Row="1"
                Background="#141419"
                BorderBrush="#4B3A86"
                BorderThickness="1"
                CornerRadius="8"
                Padding="8"
                SelectedIndex="{Binding SelectedTabIndex}">

      <!-- Charges Tab -->
      <TabItem Header="Charges">
        <Grid RowDefinitions="Auto,*,Auto" Margin="12">

          <TextBlock Grid.Row="0"
                     Text="Guest Charges"
                     FontWeight="SemiBold"
                     FontSize="14"
                     Foreground="#E8E8F0"
                     Margin="0,0,0,8"/>

          <Border Grid.Row="1"
                  Background="#1B1B22"
                  BorderBrush="#3F2F73"
                  BorderThickness="1"
                  CornerRadius="6"
                  Margin="0,0,0,12">
            <DataGrid ItemsSource="{Binding Charges}"
                      AutoGenerateColumns="False"
                      HeadersVisibility="Column"
                      GridLinesVisibility="All"
                      CanUserSortColumns="True"
                      CanUserResizeColumns="True"
                      IsReadOnly="True"
                      RowHeight="32"
                      Background="#1B1B22">
              <DataGrid.Columns>
                <DataGridTextColumn Header="Date" Width="*"
                                    Binding="{Binding TransactionDate, StringFormat='{}{0:yyyy-MM-dd HH:mm}'}"/>
                <DataGridTextColumn Header="Description" Width="3*"
                                    Binding="{Binding Description}"/>
                <DataGridTextColumn Header="Amount" Width="*"
                                    Binding="{Binding Amount, StringFormat='${0:F2}'}"/>
                <DataGridTemplateColumn Header="Actions" Width="*">
                  <DataGridTemplateColumn.CellTemplate>
                    <DataTemplate>
                      <Button Content="Remove"
                              Command="{Binding $parent[Window].((vms:GuestDetailViewModel)DataContext).RemoveChargeCommand}"
                              CommandParameter="{Binding}"
                              Padding="8,4"
                              FontSize="11"
                              Background="#D32F2F"
                              BorderBrush="#F44336"
                              CornerRadius="4"/>
                    </DataTemplate>
                  </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
              </DataGrid.Columns>
            </DataGrid>
          </Border>

          <Border Grid.Row="2"
                  Background="#18181E"
                  BorderBrush="#3F2F73"
                  BorderThickness="1"
                  CornerRadius="6"
                  Padding="12">
            <StackPanel Spacing="8">
              <TextBlock Text="Add New Charge"
                         FontWeight="SemiBold"
                         FontSize="12"
                         Foreground="#E8E8F0"/>
              <Grid ColumnDefinitions="3*,*,Auto">
                <TextBox Grid.Column="0"
                         Watermark="Description (e.g., Room Service)"
                         Text="{Binding ChargeDescription}"/>
                <TextBox Grid.Column="1"
                         Watermark="Amount"
                         Text="{Binding ChargeAmount}"/>
                <Button Grid.Column="2"
                        Content="Add Charge"
                        Command="{Binding AddChargeCommand}"
                        Padding="16,8"
                        Background="#5E35B1"
                        BorderBrush="#7E57C2"
                        CornerRadius="6"/>
              </Grid>
            </StackPanel>
          </Border>
        </Grid>
      </TabItem>

      <!-- Payments Tab -->
      <TabItem Header="Payments">
        <Grid RowDefinitions="Auto,*,Auto" Margin="12">

          <TextBlock Grid.Row="0"
                     Text="Guest Payments"
                     FontWeight="SemiBold"
                     FontSize="14"
                     Foreground="#E8E8F0"
                     Margin="0,0,0,8"/>

          <Border Grid.Row="1"
                  Background="#1B1B22"
                  BorderBrush="#3F2F73"
                  BorderThickness="1"
                  CornerRadius="6"
                  Margin="0,0,0,12">
            <DataGrid ItemsSource="{Binding Payments}"
                      AutoGenerateColumns="False"
                      HeadersVisibility="Column"
                      GridLinesVisibility="All"
                      CanUserSortColumns="True"
                      CanUserResizeColumns="True"
                      IsReadOnly="True"
                      RowHeight="32"
                      Background="#1B1B22">
              <DataGrid.Columns>
                <DataGridTextColumn Header="Date" Width="*"
                                    Binding="{Binding TransactionDate, StringFormat='{}{0:yyyy-MM-dd HH:mm}'}"/>
                <DataGridTextColumn Header="Description" Width="2*"
                                    Binding="{Binding Description}"/>
                <DataGridTextColumn Header="Reference" Width="*"
                                    Binding="{Binding Reference}"/>
                <DataGridTextColumn Header="Amount" Width="*"
                                    Binding="{Binding Amount, StringFormat='${0:F2}'}"/>
                <DataGridTemplateColumn Header="Actions" Width="*">
                  <DataGridTemplateColumn.CellTemplate>
                    <DataTemplate>
                      <Button Content="Remove"
                              Command="{Binding $parent[Window].((vms:GuestDetailViewModel)DataContext).RemovePaymentCommand}"
                              CommandParameter="{Binding}"
                              Padding="8,4"
                              FontSize="11"
                              Background="#D32F2F"
                              BorderBrush="#F44336"
                              CornerRadius="4"/>
                    </DataTemplate>
                  </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
              </DataGrid.Columns>
            </DataGrid>
          </Border>

          <Border Grid.Row="2"
                  Background="#18181E"
                  BorderBrush="#3F2F73"
                  BorderThickness="1"
                  CornerRadius="6"
                  Padding="12">
            <StackPanel Spacing="8">
              <TextBlock Text="Add New Payment"
                         FontWeight="SemiBold"
                         FontSize="12"
                         Foreground="#E8E8F0"/>
              <Grid ColumnDefinitions="*,*,*,Auto">
                <TextBox Grid.Column="0"
                         Watermark="Amount"
                         Text="{Binding PaymentAmount}"/>
                <ComboBox Grid.Column="1"
                          ItemsSource="{Binding PaymentMethods}"
                          SelectedItem="{Binding PaymentMethod}"/>
                <TextBox Grid.Column="2"
                         Watermark="Reference (optional)"
                         Text="{Binding PaymentReference}"/>
                <Button Grid.Column="3"
                        Content="Add Payment"
                        Command="{Binding AddPaymentCommand}"
                        Padding="16,8"
                        Background="#2E7D32"
                        BorderBrush="#4CAF50"
                        CornerRadius="6"/>
              </Grid>
            </StackPanel>
          </Border>
        </Grid>
      </TabItem>

      <!-- Audit Log Tab -->
      <TabItem Header="Audit Log">
        <Grid RowDefinitions="Auto,*" Margin="12">

          <TextBlock Grid.Row="0"
                     Text="Transaction History"
                     FontWeight="SemiBold"
                     FontSize="14"
                     Foreground="#E8E8F0"
                     Margin="0,0,0,8"/>

          <Border Grid.Row="1"
                  Background="#1B1B22"
                  BorderBrush="#3F2F73"
                  BorderThickness="1"
                  CornerRadius="6">
            <DataGrid ItemsSource="{Binding AuditLog}"
                      AutoGenerateColumns="False"
                      HeadersVisibility="Column"
                      GridLinesVisibility="All"
                      CanUserSortColumns="True"
                      CanUserResizeColumns="True"
                      IsReadOnly="True"
                      RowHeight="32"
                      Background="#1B1B22">
              <DataGrid.Columns>
                <DataGridTextColumn Header="Time" Width="2*"
                                    Binding="{Binding Timestamp, StringFormat='{}{0:yyyy-MM-dd HH:mm:ss}'}"/>
                <DataGridTextColumn Header="Action" Width="*"
                                    Binding="{Binding Action}"/>
                <DataGridTextColumn Header="Description" Width="3*"
                                    Binding="{Binding Description}"/>
                <DataGridTextColumn Header="User" Width="*"
                                    Binding="{Binding User}"/>
              </DataGrid.Columns>
            </DataGrid>
          </Border>
        </Grid>
      </TabItem>
    </TabControl>

    <!-- Footer -->
    <Grid Grid.Row="2" ColumnDefinitions="*,Auto" Margin="0,12,0,0">
      <TextBlock Grid.Column="0"
                 VerticalAlignment="Center"
                 FontSize="12"
                 Opacity="0.7"
                 Text="Changes are saved automatically"/>

      <Button Grid.Column="1"
              Content="Close"
              Command="{Binding CloseCommand}"
              CommandParameter="{Binding $parent[Window]}"
              Padding="24,10"
              Background="#424242"
              BorderBrush="#616161"
              CornerRadius="6"/>
    </Grid>
  </Grid>
</Window>
