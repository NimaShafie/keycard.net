<!-- Views/MainWindow.axaml -->
<Window
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:vms="clr-namespace:KeyCard.Desktop.ViewModels"
    xmlns:st="clr-namespace:Avalonia.Styling;assembly=Avalonia.Styling"
    x:Class="KeyCard.Desktop.Views.MainWindow"
    xmlns:conv="clr-namespace:KeyCard.Desktop.Converters"
    x:DataType="vms:MainViewModel"
    Width="1100" Height="700"
    WindowStartupLocation="CenterScreen"
    Title="KeyCard.NET â€” Staff Console"
    Background="#0F0F12">

  <Window.Resources>
    <conv:ModeToBrushConverter x:Key="ModeToBrushConverter"/>
    <conv:BoolToOpacityConverter x:Key="BoolToOpacityConverter" TrueOpacity="0.6" FalseOpacity="1"/>
    <conv:ModeIsMockConverter x:Key="ModeIsMockConverter"/>
  </Window.Resources>

  <Grid RowDefinitions="Auto,Auto,*">
    <!-- Top Bar -->
    <Border Grid.Row="1" Height="64" Padding="16,0">
      <Border.Background>
        <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
          <GradientStop Color="#6F3BF5" Offset="0"/>
          <GradientStop Color="#3A2E5E" Offset="0.55"/>
          <GradientStop Color="#1B1B22" Offset="1"/>
        </LinearGradientBrush>
      </Border.Background>

      <Grid ColumnDefinitions="*,Auto,*">
        <!-- LEFT: Dashboard button (improved visuals + centered text) -->
        <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Spacing="8">
          <Button Content="Dashboard"
                  Classes="topbarBtn"
                  Command="{Binding NavigateDashboardCommand}"
                  IsVisible="{Binding IsAuthenticated}"/>
        </StackPanel>

        <!-- CENTER: app title -->
        <TextBlock Grid.Column="1"
                   Text="KeyCard.NET"
                   FontSize="22"
                   FontWeight="Bold"
                   HorizontalAlignment="Center"
                   VerticalAlignment="Center"
                   Foreground="White"/>

        <!-- RIGHT: profile area -->
        <StackPanel Grid.Column="2"
                    Orientation="Horizontal"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Center"
                    Spacing="10"
                    IsVisible="{Binding IsAuthenticated}">
          <TextBlock Text="{Binding DisplayName}"
                     Foreground="White"
                     VerticalAlignment="Center"
                     Opacity="0.92"/>

          <Border x:Name="ModeChip"
                  CornerRadius="8"
                  Padding="8,4"
                  Margin="0,0,8,0"
                  VerticalAlignment="Center">
            <TextBlock x:Name="ModeChipText"
                       Text="{Binding ModeLabel}"
                       FontWeight="SemiBold"
                       VerticalAlignment="Center"/>
          </Border>

          <Button Classes="profileButton"
                  Command="{Binding OpenProfileMenuCommand}">
            <Button.Content>
              <Grid Width="36" Height="36">
                <Ellipse Fill="#2C2C34" />
                <TextBlock Text="{Binding AvatarInitials}"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"
                           FontWeight="SemiBold"
                           Foreground="White"/>
              </Grid>
            </Button.Content>
            <Button.Flyout>
              <MenuFlyout>
                <MenuItem Header="Profile"  Command="{Binding OpenProfileCommand}"/>
                <MenuItem Header="Settings" Command="{Binding OpenSettingsCommand}"/>
                <Separator/>
                <MenuItem Header="Logout"   Command="{Binding LogoutCommand}"/>
              </MenuFlyout>
            </Button.Flyout>
          </Button>
        </StackPanel>
      </Grid>
    </Border>

    <!-- MODE BANNER -->
    <Border Grid.Row="0"
            HorizontalAlignment="Stretch"
            CornerRadius="8"
            Padding="8,4"
            Margin="8,6,8,6"
            Background="#2B2B33"
            BorderBrush="{Binding ModeLabel, Converter={StaticResource ModeToBrushConverter}}"
            BorderThickness="1">
      <TextBlock Text="{Binding ModeLabel}"
                 HorizontalAlignment="Center"
                 FontWeight="SemiBold"
                 VerticalAlignment="Center"
                 Foreground="{Binding ModeLabel, Converter={StaticResource ModeToBrushConverter}}"/>
    </Border>

    <!-- Page content -->
    <Border Grid.Row="2" Margin="12">
      <Border.Background>
        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
          <GradientStop Color="#111117" Offset="0"/>
          <GradientStop Color="#12131A" Offset="1"/>
        </LinearGradientBrush>
      </Border.Background>

      <Border CornerRadius="12" BorderBrush="#5C46A3" BorderThickness="1" Padding="12">
        <ContentControl Content="{Binding Current}"/>
      </Border>
    </Border>
  </Grid>

  <Window.Styles>
    <Style Selector="Button.profileButton">
      <Setter Property="Background" Value="#00000000"/>
      <Setter Property="BorderBrush" Value="#00000000"/>
      <Setter Property="Padding" Value="0"/>
    </Style>

    <!-- Border#ModeChip -->
    <Style Selector="Border#ModeChip">
      <Setter Property="Background" Value="#2B2B33"/>
      <Setter Property="BorderBrush"
              Value="{Binding ModeLabel, Converter={StaticResource ModeToBrushConverter}}"/>
      <Setter Property="BorderThickness" Value="1"/>
    </Style>

    <!-- DataGridRow:selected -->
    <Style Selector="DataGridRow:selected">
      <Setter Property="Opacity"
              Value="{Binding DataContext,
                              RelativeSource={RelativeSource AncestorType=DataGridRow},
                              Converter={StaticResource BoolToOpacityConverter}}"/>
    </Style>

    <!-- TextBlock#ModeChipText -->
    <Style Selector="TextBlock#ModeChipText">
      <Setter Property="Foreground"
              Value="{Binding ModeLabel,
                              Converter={StaticResource ModeToBrushConverter},
                              FallbackValue=#CFCFF1,
                              TargetNullValue=#CFCFF1}"/>
    </Style>

    <!-- Topbar button look -->
    <Style Selector="Button.topbarBtn">
      <Setter Property="Height" Value="36"/>
      <Setter Property="MinWidth" Value="110"/>
      <Setter Property="Padding" Value="14,0"/>
      <Setter Property="CornerRadius" Value="10"/>
      <Setter Property="VerticalContentAlignment" Value="Center"/>
      <Setter Property="HorizontalContentAlignment" Value="Center"/>
      <Setter Property="Background" Value="#3B3B44"/>
      <Setter Property="Foreground" Value="White"/>
      <Setter Property="BorderBrush" Value="#5C46A3"/>
      <Setter Property="BorderThickness" Value="1"/>
      <Setter Property="Opacity" Value="0.92"/>
      <Setter Property="Transitions">
        <Transitions>
          <DoubleTransition Property="Opacity" Duration="0:0:0.12"/>
        </Transitions>
      </Setter>
    </Style>
    <Style Selector="Button.topbarBtn:pointerover">
      <Setter Property="Opacity" Value="1"/>
    </Style>
    <Style Selector="Button.topbarBtn:pressed">
      <Setter Property="Opacity" Value="0.85"/>
    </Style>
  </Window.Styles>
</Window>
