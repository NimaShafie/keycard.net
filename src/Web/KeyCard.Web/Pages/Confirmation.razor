@page "/confirmation"
@inject NavigationManager Nav
@inject KeyCard.Web.Services.BookingStateService BookingState
@inject KeyCard.Web.Services.AuthStateService AuthState

<div class="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 py-10 px-4">
    <div class="max-w-lg mx-auto">
        <!-- Success Animation -->
        <div class="text-center mb-8">
            <div class="inline-flex items-center justify-center w-20 h-20 rounded-full bg-emerald-500 text-white text-4xl mb-4 animate-bounce">
                ‚úì
            </div>
            <h1 class="text-3xl font-bold text-slate-900">Booking Confirmed!</h1>
            <p class="text-slate-500 mt-2">Your reservation has been successfully created</p>
        </div>

        <!-- Confirmation Card -->
        <div class="bg-white rounded-3xl shadow-xl border border-slate-100 overflow-hidden">
            <!-- Confirmation Code Banner -->
            <div class="bg-gradient-to-r from-amber-500 to-amber-600 p-6 text-center">
                <p class="text-amber-100 text-sm mb-1">Confirmation Code</p>
                <p class="text-3xl font-mono font-bold text-white tracking-widest">
                    @BookingState.ConfirmationCode
                </p>
                <p class="text-amber-100 text-xs mt-2">Save this code for check-in</p>
            </div>

            <!-- Booking Details -->
            <div class="p-6">
                <h3 class="font-semibold text-slate-700 mb-4 flex items-center gap-2">
                    <span>üìã</span> Booking Details
                </h3>

                <div class="space-y-3 text-sm">
                    <div class="flex justify-between py-2 border-b border-slate-100">
                        <span class="text-slate-500">Room Type</span>
                        <span class="font-medium text-slate-900">@BookingState.SelectedRoomType</span>
                    </div>
                    <div class="flex justify-between py-2 border-b border-slate-100">
                        <span class="text-slate-500">Room Number</span>
                        <span class="font-medium text-slate-900">@BookingState.SelectedRoomNumber</span>
                    </div>
                    <div class="flex justify-between py-2 border-b border-slate-100">
                        <span class="text-slate-500">Check-in</span>
                        <span class="font-medium text-slate-900">@BookingState.CheckInDate?.ToString("ddd, MMM dd, yyyy")</span>
                    </div>
                    <div class="flex justify-between py-2 border-b border-slate-100">
                        <span class="text-slate-500">Check-out</span>
                        <span class="font-medium text-slate-900">@BookingState.CheckOutDate?.ToString("ddd, MMM dd, yyyy")</span>
                    </div>
                    <div class="flex justify-between py-2 border-b border-slate-100">
                        <span class="text-slate-500">Duration</span>
                        <span class="font-medium text-slate-900">@BookingState.Nights night@(BookingState.Nights > 1 ? "s" : "")</span>
                    </div>
                    <div class="flex justify-between py-2 border-b border-slate-100">
                        <span class="text-slate-500">Guests</span>
                        <span class="font-medium text-slate-900">
                            @BookingState.Adults adult@(BookingState.Adults > 1 ? "s" : "")@(BookingState.Children > 0 ? $", {BookingState.Children} child" + (BookingState.Children > 1 ? "ren" : "") : "")
                        </span>
                    </div>
                    <div class="flex justify-between py-3 bg-amber-50 -mx-6 px-6 mt-4">
                        <span class="font-semibold text-slate-700">Total Paid</span>
                        <span class="font-bold text-xl text-amber-600">$@BookingState.TotalAmount.ToString("0.00")</span>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="space-y-3 mt-6">
                    <button @onclick="ViewMyBookings"
                            class="w-full py-3 rounded-xl bg-slate-900 text-white font-semibold hover:bg-slate-800 transition flex items-center justify-center gap-2">
                        üìã View My Bookings
                    </button>
                    <button class="w-full py-3 rounded-xl border border-slate-200 text-slate-700 font-medium hover:bg-slate-50 transition flex items-center justify-center gap-2">
                        üìß Email Confirmation
                    </button>
                    <button @onclick="MakeAnotherBooking"
                            class="w-full py-3 rounded-xl border border-slate-200 text-slate-700 font-medium hover:bg-slate-50 transition">
                        Make Another Booking
                    </button>
                </div>
            </div>
        </div>

        <!-- Info Banner -->
        <div class="mt-6 bg-blue-50 border border-blue-200 rounded-2xl p-4">
            <div class="flex gap-3">
                <span class="text-2xl">‚ÑπÔ∏è</span>
                <div class="text-sm">
                    <p class="font-medium text-blue-800">Check-in Information</p>
                    <p class="text-blue-600 mt-1">
                        Check-in starts at 3:00 PM on @BookingState.CheckInDate?.ToString("MMM dd"). 
                        Present your confirmation code at the front desk or use our self-service kiosk.
                    </p>
                </div>
            </div>
        </div>

        <!-- Self Check-in Reminder -->
        @if (BookingState.CheckInDate?.Date == DateTime.Today)
        {
            <div class="mt-4 bg-emerald-50 border border-emerald-200 rounded-2xl p-4">
                <div class="flex gap-3">
                    <span class="text-2xl">üîë</span>
                    <div class="text-sm">
                        <p class="font-medium text-emerald-800">Ready for Check-in!</p>
                        <p class="text-emerald-600 mt-1">
                            Your check-in date is today! You can check in from your dashboard to receive your digital room key.
                        </p>
                    </div>
                </div>
            </div>
        }

        <p class="text-center text-xs text-slate-400 mt-6">
            A confirmation email has been sent to your email address.
        </p>
    </div>
</div>

@code {
    protected override void OnInitialized()
    {
        // Redirect if no confirmation code
        if (string.IsNullOrEmpty(BookingState.ConfirmationCode))
        {
            Nav.NavigateTo("/dates");
        }
    }

    private void ViewMyBookings()
    {
        Nav.NavigateTo("/dashboard");
    }

    private void MakeAnotherBooking()
    {
        BookingState.Reset();
        Nav.NavigateTo("/dates");
    }
}
